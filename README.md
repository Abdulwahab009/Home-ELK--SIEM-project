# Home-ELK--SIEM-project
 This project was to build a functioning SIEM setup on personel window machine using Sysmon, Elastic Agent,logstash, Elasticsearch, and Kibana.

Objective
This project involves setting up a SIEM solution to monitor and detect security threats by capturing and analyzing logs. The setup integrates Sysmon, Elastic Agent, Logstash, Elasticsearch, and Kibana, enabling real-time detection of suspicious activities through customized alerts and visual dashboards.

Skills Learned
Practical experience with deploying and configuring a SIEM solution.
Understanding and creating custom detection rules for various security events.
Analysis and correlation of log data for actionable insights.
Network and endpoint monitoring for enhanced cybersecurity.


Tools Used
Sysmon: Captures detailed Windows system events, like process creation and network connections.
Elastic Agent: Collects logs from endpoints and forwards them to the SIEM.
Logstash: Processes, filters, and enriches log data before it’s stored.
Elasticsearch: Central storage and search engine for logs.
Kibana: Provides visualizations and dashboards for monitoring logs and managing alerts.
Steps


1. Network Diagram
Ref 1: Network Diagram


![My SEIMPRO DIAGRAM](https://github.com/user-attachments/assets/2dd014bf-b6f7-43e7-a931-3d2f3b24bbed)

This diagram shows the setup: Sysmon logs are captured on endpoints, forwarded by Elastic Agent, optional logs processed through Logstash, stored in Elasticsearch, and visualized and Creating Rules and alerts in Kibana.



2. Sysmon and Elastic Agent Configuration

Ref 2: Sysmon Config File
The Sysmon configuration is tailored to capture key security events like process creation and network connections, which are critical for detecting suspicious activity but first of all u need to download Sysmon, extract its file and install. You will get installation guide on their website.
![Screenshot (33)](https://github.com/user-attachments/assets/854a15b4-4c4b-477d-8852-7c568731940a)

After installation u need to confirm that Sysmon is working properly or not to do that u can follow below steps,

Open Event Viewer by typing eventvwr in the Windows Run dialog (Win + R

Go to Applications and Services Logs > Microsoft > Windows > Sysmon > Operational.

If Sysmon is running, you’ll see recent event logs here. Look for events with IDs like 1, 3, and 10 (process creation, network connections, and file creation, respectively), which are typically generated by Sysmon.

We will discuss Elastic agent in the end after setting Up over elastic search and Kibana.

3. Logstash Pipeline Configuration
Logstash acts as an intermediary that parses and enriches logs from Elastic Agent before sending them to Elasticsearch. This configuration file shows the filters applied, which structure data for easier searching and alerting.

first of all you need to download logstash, download zip file extract it in ur desire folder, 
after extraction u need to configure your logstash to make it working.

i am dropping some sample files in logstash configuration files for your idea so that u can configure yours as you wanted to.

Before configurations i wanted you to know about this.

if u want to Run logstash by default and by Default i mean from /bin with logstash.bat command, then u need to configure your pipeline.yml file of logsatsh, i will drop a sample in conf file, and if you want to run it with specific folder path then u have to provide specific folder path e.g
logstash.bat -f "path/to/your/config/file.conf".

here is a  screen shoot of sample file. 
![Screenshot (34)](https://github.com/user-attachments/assets/63a45dd1-adc3-40db-948a-79735d364a91)

u will find rest of configurations in logstash.conf file.


6. Elastic-Search  and Kibana Installation 

Download elstic search and Kibana from  offical web extract it in ur desire folder.

after u installed elastic search and kibana  go to bin directory of elastic and start it. when u are in ELastic bin directory start it with elasticsearch.bat command it will take some time and will provide u with some information that info will contain An enrollment token and pass for elastic.

Now i want u to read this section very carefully other wise setting up ELk can be so frustrating,

Open Note pad and save provided info by elasticsearch in that

Verify Installation

Open your browser:

Go to https://localhost:9200.

window will pop up and will be asking for username and pass, User name will be elastic and password is the one that was initially provided by Elastic copy that from notepas and paste it here and login.

Check the response:
You should see a JSON response that includes information about your Elasticsearch node.

after u make sure that elastic is installed properly,

 Go into the kibana folder and bin directory open it with cmd and run Kibana.bat command which will start kibana.

By default, Kibana runs in the foreground, prints its logs to STDOUT, and can be stopped by pressing Ctrl-C.

If this is the first time you’re starting Kibana, this command generates a unique link in your terminal to enroll your Kibana instance with Elasticsearch.
paste that link inthe browser and something like this will pop up,

![Screenshot (35)](https://github.com/user-attachments/assets/80e84c4d-448f-4799-98a2-21d6a2f6e2ac)

paste enrollment token initially give/generated by elastic search terminal.

![Screenshot (36)](https://github.com/user-attachments/assets/d4a32caa-1ea2-4d26-b2f4-6b1bc1187c22)

after this it will ask for vrification code, u will find it kibana Running terminal.

![Screenshot (37)](https://github.com/user-attachments/assets/edd5def6-c2f5-4d38-b0c6-224172380508)

take that code and paste it in it and it will start configuring Kibana Automatically and kibana will get started,

Now close it and go to kibana.yml file scroll down and u will see there an automatic section will be generated, like this but i will not include these 

elasticsearch.hosts: ['https://192.168.1.2:9200']

elasticsearch.username: "kibana_system"

elasticsearch.password: ur password

u have to add these manually.

![Screenshot (38)](https://github.com/user-attachments/assets/1ec62478-94cf-4ebd-ab11-e57fdda791cc)

Now first go to Elastic search bin and open cmd there and make sure Elastic is up and running u need to open this one as new terminal when it is open type in command 

./elasticsearch-setup-passwords auto

it will generate new passwords for both kibana_system and elastic 

now in kibana.YML file Comment out elasticsearch.serviceAccountToken and add manuall integration i have provided u above with your new pass,and save it.

Note: make sure u save new passwords in notepad too.

after u are done with this now go to the Kibana folder and bin folder open cmd there and run kibana with kibana.cmd command. 

when its up and running go to google and search for localhost:5601 make sure use https not http or it wont work.

when Kibana window pop up This time it will ask for User Name and pass 
your user name will be "elastic"

and for password use that new elstic pass not old one and we are good to Go.
![Screenshot (39)](https://github.com/user-attachments/assets/d8f3d65e-caee-421e-84ad-dc96f30b69bd)

7.Adding Elastic Agent

we can do this with fleet but for this we will add elastic agent as stand alone agent.

first u will download elastic agent from official webiste and extract zip file in you project folder.

go and open Elastic agent.Yml file i will drop a sample in Elastic agent.conf file for ur understanding,

in YMl file comment out API key and un-comment username and pass, put ur elastic username and pass here and save the file.

now got to elastic agent directory where u installed it and make sure that u are in the right directoty open Cmd there and Run

elastic-agent .exe install

say yes to first inquiry and NO to the fleet server Inquiry/Option. and it will install elastic agent, 

after that now Go to the Kibana Home page and click on side bar on Extreme top left and scroll all the way Down,
you will see integration click on it 
![Screenshot (41)](https://github.com/user-attachments/assets/acf7b852-1cea-484c-b272-7353353d45a2)


Search for window 
![Screenshot (42)](https://github.com/user-attachments/assets/1dffb18d-1b5a-4561-b765-a5f50d594c4e)

click on it and then click on Add window
![Screenshot (43)](https://github.com/user-attachments/assets/29a28fd7-bc08-47c4-b413-48f1f03a8ce7)


After stay with defaults go down click on save and Continue,
![Screenshot (44)](https://github.com/user-attachments/assets/bfbeaedb-32c6-4055-ba3a-09f5702333ee)

after you will get into integration policies click on add agent,
![Screenshot (45)](https://github.com/user-attachments/assets/c1361fe4-2140-4bef-b69d-7c6541da1480)

add agent window will popup click on stand alone agent and u will be provided with config file copy it and go to elastic agent.yml file scroll down and paste it there.
![Screenshot (46)](https://github.com/user-attachments/assets/c0432ba2-ad90-4294-a835-a4a3fc425e85)

after Go to the elasttic agent diretory C:\Program Files\Elastic and uninstall it with this command 

elastic-agent .exe uninstall

then go to the downlaod directory again where u downloaded your elastic agent and install it again with same command we used for first installation. it will pick new configurations and we are good to go now 

now lets Go to kibana click on Discover and we will se logs will be  start coming to kibana 

8. Kibana Rules and Alerts

IN kibana u can set up Rules, alerts and Dashboards for your logs as per your demands/priorities.

Here i will tell u about 2 Rules so that u understads basics that how kibana Rules and alerts work, and after you can work on your personel rules and alerts 

8.1 Privilege Escalation
Monitor when processes like cmd.exe or powershell.exe are run with admin privileges.
![Screenshot (47)](https://github.com/user-attachments/assets/978356cd-2695-462c-ab14-dac29c956619)

![Screenshot (48)](https://github.com/user-attachments/assets/cac2e022-d53b-4438-83ab-6055522e9336)

you can see query and required feilds details in SS u gan get these details by analysing your logs no need to copy any thing your logs will give u enough info to create any rule u want.
![Screenshot (51)](https://github.com/user-attachments/assets/43a2d81d-72d6-4ca5-934f-de53294852d5)
You can see every time someone tries to open cmd or powershell as admin it will generate alerts 

8.2 MicroSoft Defender Activities
this rule is about when someone tries to turn off defender it will triger an alert
![Screenshot (53)](https://github.com/user-attachments/assets/b3f85f75-6a2c-47fe-849d-ffddcd460b3d)

![Screenshot (54)](https://github.com/user-attachments/assets/76c88f1c-74d2-49f4-a381-c223f73b2617)

u can see necessary details in screen shoots 
![Screenshot (55)](https://github.com/user-attachments/assets/fd6b8d43-0bb5-46c7-919e-4c11362c9318)

u can see when i try to turn off defender at generates alert.

you can also create dashboards for your self as per your requirements i will drop some screen shots for your understanding 

![Screenshot (56)](https://github.com/user-attachments/assets/7afd8cdb-30a7-4dfe-8c32-f40cd75b859b)

![Screenshot (57)](https://github.com/user-attachments/assets/af5ff274-746a-4a7a-bf92-9b25b9896fb1)

![Screenshot (58)](https://github.com/user-attachments/assets/bd33b85c-0d0c-4281-92b3-3ab83d32b3f8)


this is how u can create your dashboards as per your requirements u can see in last screen shoot you can drag fields of your intrest to the center then save it and return, 
Congrates Your dashboard is created.

I Hope this helps u in setting up your Home lab, as begginer like me u may find things hard but dont give up u get it in the end. 

keep working and growing.





